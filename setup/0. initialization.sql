IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
GO

BEGIN TRANSACTION;
GO

CREATE TABLE [AspNetRoles] (
    [Id] nvarchar(225) NOT NULL,
    [Name] nvarchar(256) NULL,
    [NormalizedName] nvarchar(256) NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    CONSTRAINT [PK_AspNetRoles] PRIMARY KEY ([Id])
);
GO

CREATE TABLE [AspNetUsers] (
    [Id] nvarchar(225) NOT NULL,
    [UserName] nvarchar(256) NULL,
    [NormalizedUserName] nvarchar(256) NULL,
    [Email] nvarchar(256) NULL,
    [NormalizedEmail] nvarchar(256) NULL,
    [EmailConfirmed] bit NOT NULL,
    [PasswordHash] nvarchar(max) NULL,
    [SecurityStamp] nvarchar(max) NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    [PhoneNumber] nvarchar(max) NULL,
    [PhoneNumberConfirmed] bit NOT NULL,
    [TwoFactorEnabled] bit NOT NULL,
    [LockoutEnd] datetimeoffset NULL,
    [LockoutEnabled] bit NOT NULL,
    [AccessFailedCount] int NOT NULL,
    CONSTRAINT [PK_AspNetUsers] PRIMARY KEY ([Id])
);
GO

CREATE TABLE [AspNetRoleClaims] (
    [Id] int NOT NULL IDENTITY,
    [RoleId] nvarchar(225) NOT NULL,
    [ClaimType] nvarchar(max) NULL,
    [ClaimValue] nvarchar(max) NULL,
    CONSTRAINT [PK_AspNetRoleClaims] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_AspNetRoleClaims_AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [AspNetRoles] ([Id]) ON DELETE CASCADE
);
GO

CREATE TABLE [AspNetUserClaims] (
    [Id] int NOT NULL IDENTITY,
    [UserId] nvarchar(225) NOT NULL,
    [ClaimType] nvarchar(max) NULL,
    [ClaimValue] nvarchar(max) NULL,
    CONSTRAINT [PK_AspNetUserClaims] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_AspNetUserClaims_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [AspNetUsers] ([Id]) ON DELETE CASCADE
);
GO

CREATE TABLE [AspNetUserLogins] (
    [LoginProvider] nvarchar(112) NOT NULL,
    [ProviderKey] nvarchar(128) NOT NULL,
    [ProviderDisplayName] nvarchar(max) NULL,
    [UserId] nvarchar(225) NOT NULL,
    CONSTRAINT [PK_AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey]),
    CONSTRAINT [FK_AspNetUserLogins_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [AspNetUsers] ([Id]) ON DELETE CASCADE
);
GO

CREATE TABLE [AspNetUserRoles] (
    [UserId] nvarchar(225) NOT NULL,
    [RoleId] nvarchar(225) NOT NULL,
    CONSTRAINT [PK_AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId]),
    CONSTRAINT [FK_AspNetUserRoles_AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [AspNetRoles] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_AspNetUserRoles_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [AspNetUsers] ([Id]) ON DELETE CASCADE
);
GO

CREATE TABLE [AspNetUserTokens] (
    [UserId] nvarchar(225) NOT NULL,
    [LoginProvider] nvarchar(112) NOT NULL,
    [Name] nvarchar(112) NOT NULL,
    [Value] nvarchar(max) NULL,
    CONSTRAINT [PK_AspNetUserTokens] PRIMARY KEY ([UserId], [LoginProvider], [Name]),
    CONSTRAINT [FK_AspNetUserTokens_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [AspNetUsers] ([Id]) ON DELETE CASCADE
);
GO

CREATE INDEX [IX_AspNetRoleClaims_RoleId] ON [AspNetRoleClaims] ([RoleId]);
GO

CREATE UNIQUE INDEX [RoleNameIndex] ON [AspNetRoles] ([NormalizedName]) WHERE [NormalizedName] IS NOT NULL;
GO

CREATE INDEX [IX_AspNetUserClaims_UserId] ON [AspNetUserClaims] ([UserId]);
GO

CREATE INDEX [IX_AspNetUserLogins_UserId] ON [AspNetUserLogins] ([UserId]);
GO

CREATE INDEX [IX_AspNetUserRoles_RoleId] ON [AspNetUserRoles] ([RoleId]);
GO

CREATE INDEX [EmailIndex] ON [AspNetUsers] ([NormalizedEmail]);
GO

CREATE UNIQUE INDEX [UserNameIndex] ON [AspNetUsers] ([NormalizedUserName]) WHERE [NormalizedUserName] IS NOT NULL;
GO

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'00000000000000_CreateIdentitySchema', N'7.0.5');
GO

COMMIT;
GO
--===================================================
CREATE TABLE dbo.Product
(
	SerialNumber varchar(38) NOT NULL,
	CONSTRAINT PK_Product PRIMARY KEY (SerialNumber)
)
GO

-- Seed Serial numbers
--delete from dbo.Product
DECLARE @count int  = 1
IF NOT EXISTS(SELECT SerialNumber FROM dbo.Product)
BEGIN

	INSERT INTO dbo.Product (SerialNumber)
	VALUES
		('SN01749A64-C80F-4E86-89B2-A244FDC782F9'),
		('SN02F23FAF-0BF8-49DC-8151-206FB81FB3C1'),
		('SN03ACCB5A-124F-4E32-B037-87691A47A3ED'),
		('SN05412E5D-5F95-4C1F-9701-60188EDB2862'),
		('SN08461816-2B81-46B9-B450-C48D1896B138'),
		('SN0B1F71C6-FE4B-4925-853E-2E0F2F0CFF3C'),
		('SN0EF37996-B74C-4ECE-B60C-9705EF4720FF'),
		('SN102AFE6D-3524-4E84-AE53-792262F9CC70'),
		('SN17DC972C-55E9-4972-B64E-1CFC716FC380'),
		('SN17F39A9F-22A3-44D3-BB48-2BF167E70B7C'),
		('SN183B47CB-03AE-4D18-B5DE-0D4E0C595943'),
		('SN1C85DFC6-6A5F-4207-A875-EAD3146BF761'),
		('SN1DDB8E1E-84AC-400C-B733-E39693B8EA0E'),
		('SN1FF7610B-A5BE-48D4-98C7-7C897EBD5C7A'),
		('SN21739E82-BB0E-4885-BC3D-A8C682DD5439'),
		('SN2521C2EE-062A-441B-B7AC-05FF4C2954E6'),
		('SN26EE203D-3CB5-4FA7-A299-DD372A4F32D9'),
		('SN282F9E4F-4E7A-4015-9933-42120173AD49'),
		('SN2B50479A-16A9-487F-AF5A-6F8BA73723D0'),
		('SN2BB665F4-F16B-433F-AC88-DD774538C60E'),
		('SN2EB5E1EC-D743-4D59-976E-FA378E49840E'),
		('SN30F27CDE-2AD8-48A6-AC5A-33E605B6E5FE'),
		('SN3D6A2F3D-0BEC-4209-8D80-04DF83A31424'),
		('SN3DDF92FE-B78E-4373-8481-AFB6A5E728D9'),
		('SN3E69F1AC-6D8E-4553-9374-BF815A490D0F'),
		('SN445FCC13-4879-4A90-B4B3-F2103078407C'),
		('SN46AC275A-B3EA-4FE8-BBE4-EE972C1D46CE'),
		('SN483CAE1B-7FC5-4A69-AF18-80CC7EA6F5DE'),
		('SN4894FF6C-7DA0-4BF2-9593-06DF6BF1C2A1'),
		('SN4924984A-49EB-4ACE-80AD-0D1039DEBCEA'),
		('SN4A364D85-7BF9-4E92-9535-9B30DB0461F0'),
		('SN4B89A6F8-D193-4704-9722-4382B0E8C92F'),
		('SN4C9A3431-3CBC-4008-98D4-232D52F04187'),
		('SN532ED879-7F36-456F-BE60-3CE736EE0907'),
		('SN5569E245-7709-49E4-8B5C-BC00737EFFB1'),
		('SN5C0C9616-3E5C-44AD-9F8B-0063A84A0714'),
		('SN63D03A57-511E-42A0-BD84-A7FE7C69E172'),
		('SN64E17839-93AB-4C8D-9A2D-C7C1E2F493F9'),
		('SN66A303F3-6E34-4693-8AD8-52D50CE515BB'),
		('SN6EF12ACF-2449-4FD0-BDCE-81FA9892E692'),
		('SN708B9355-A5C2-47EF-87CB-9BDFA6FC5C1B'),
		('SN70990185-6505-45A3-B771-1160D4977D3F'),
		('SN72B4DE5A-06E8-435A-96DA-8454DE942CC9'),
		('SN73A28208-58E0-4120-97DF-7E23CF503C2E'),
		('SN764C6743-5B80-4332-A65F-164A075E4D2C'),
		('SN76B445EF-D950-40F7-A9DA-29528A705F17'),
		('SN792B0A36-3B36-4129-BA0D-FBF7F33C111B'),
		('SN7C7A6EBF-8424-470E-AE13-7574ADB5C944'),
		('SN7FDBFDF4-0E41-413C-B9BB-9359155A3962'),
		('SN80885626-8D0B-47FD-BF21-DA331C15CB6B'),
		('SN87898B5C-BE76-4097-AB36-951B4F3FE4E4'),
		('SN89D65706-C193-41DA-AACC-F555BE14429A'),
		('SN8D01701B-576C-474E-B556-A7A0ECFA14FA'),
		('SN8E3380B3-7C57-43B9-9185-58EB0878F1A5'),
		('SN92EBA3E8-6AF8-4BCF-B70F-9D0524EC7440'),
		('SN97FAF183-E16D-4B97-AF1A-532E5C956F82'),
		('SN99D74E6F-59FB-4659-B8FB-943D8FC81A28'),
		('SN9B541ACA-AED1-4BA7-99F4-6DEB69965412'),
		('SN9C8480EF-B6C0-471B-AE0D-7B6D1855DEC8'),
		('SN9F17AEE8-7B4F-43AF-B62E-9295449CA877'),
		('SNA0EC3C46-8CCB-47A4-8DC5-9A8E91ACC6A7'),
		('SNA1057640-762B-4E05-9CE5-48A33249645C'),
		('SNA5DA5C1A-E593-49C8-B0B1-33677A3E625E'),
		('SNA744D630-C424-4DCD-A23B-C56743D69165'),
		('SNADF3D86F-FCCF-47EA-B768-E8FF7E2DFA1E'),
		('SNAFF6552F-4FDC-46B4-8328-5C33A3A9B82B'),
		('SNB333EB86-B02D-4181-BF48-6012BF320474'),
		('SNB43B05A2-C74E-477A-90BC-0BE7D5434BA8'),
		('SNB4CF1963-C5E6-495C-ABFA-7D32C62F5CB3'),
		('SNBC71DC66-7157-44DC-BCA1-B91FCEE8556C'),
		('SNBD6103DA-4F5D-48E9-A03D-846FAC0B6FC1'),
		('SNBF7EACD3-6C38-4980-BE81-3B4417B03591'),
		('SNC062357B-380E-42CA-B626-88383B01AB52'),
		('SNC529415E-D8F7-485C-82FB-99E5722CEA4E'),
		('SNC6210FA9-4563-4B11-B2DA-95471C3C9D95'),
		('SNC93FCA49-6E5C-470F-8714-2C11B23B3377'),
		('SNC965E072-422B-4CCC-B683-42C57319AF8A'),
		('SNCF4ECCA3-6FC6-4859-B605-01E810669985'),
		('SND0E5B352-E6D7-422E-85F8-2C7B4C93F99A'),
		('SND6DD5E95-8EE1-4C30-9386-E794445BBD1C'),
		('SND954CD4F-BAE0-4266-A2B1-3490F15FA6CA'),
		('SNDAF2B2F0-B0EA-4661-94FF-811C2397E729'),
		('SNDBA100AA-BCEF-4754-9538-31EA7BCC9ADD'),
		('SNDD2AFB52-5309-4972-82D7-F7618342B64E'),
		('SNDDC67B4F-D03E-44F5-AB46-4660FC987D6E'),
		('SNDF9515E7-C352-4E31-AC5E-2F5BF21307D5'),
		('SNE1A9BAB8-20FA-4380-80BD-602869F2A040'),
		('SNE22AC5CF-836B-4AEF-9046-FD4BA268254A'),
		('SNE40FBD32-8828-486C-9667-ECFE7193CC07'),
		('SNE851961F-38B4-4663-8065-E8AD61456CAC'),
		('SNE9289A90-E5E9-4DD2-A0D2-CC9B6E205DA5'),
		('SNEBB80B6B-4E41-4619-AF04-B78A9AC695D9'),
		('SNED9F33EF-140C-4F04-A272-4A044B46E12C'),
		('SNF272DDE9-1794-479A-BFE0-25DCEDB39E01'),
		('SNF3D5C0A4-0CE5-4C72-8BED-72468ED54098'),
		('SNF41B52FC-BDAB-4EEC-A63C-0840FF2C1AC1'),
		('SNFC368AD3-E026-4716-8F94-E4161C8E78C8'),
		('SNFE23E9A2-3517-48C3-8250-F8AC2000A327'),
		('SNFE34F96A-DC99-45A7-9933-C32B02A67192'),
		('SNFF6BD71E-4ECC-4AA4-95DA-DE045040E52B')
END
GO

CREATE TABLE dbo.ProductPrizeDrawSubmission
(
	Id int IDENTITY(1,1),
	OwnerFirstName nvarchar(255) NOT NULL,
	OwnerLastName nvarchar(255) NOT NULL,
	OwnerEmail nvarchar(254) NOT NULL,
	ProductSerialNumber varchar(38) NOT NULL, -- a SN can be used twice
	CONSTRAINT PK_ProductPrizeDrawSubmission PRIMARY KEY (Id),
	CONSTRAINT FK_ProductPrizeDrawSubmission_Product FOREIGN KEY(ProductSerialNumber) REFERENCES Product(SerialNumber)
)
GO
